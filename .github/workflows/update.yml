name: update
on: 
  push:
  schedule:
    - cron: '0 0 1 * *'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repo content
        uses: actions/checkout@v2 # checkout the repository content to github runner.
      - name: setup python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8 #install the python needed
      - name: execute py script # run the run.py to get the latest data
        run: |
         shopt -s globstar
         git clone https://github.com/ProgramComputer/hostsblock.git
         cd **/hostsblock
         make
         cd -
         mkdir -p easylistschina
         mkdir -p indonesianadblockrules
         mkdir -p abpvn
         mkdir -p listefr
         mkdir -p ruadlist
         curl -s "https://raw.githubusercontent.com/easylist/easylist/master/easylist/easylist_adservers.txt" | ./hostsblock/hostsblock - > hosts
         curl -s "https://raw.githubusercontent.com/easylist/easylistchina/master/easylistchina.txt" | ./hostsblock/hostsblock - > ./easylistschina/hosts
         curl -s "https://raw.githubusercontent.com/ABPindo/indonesianadblockrules/master/src/advert/adservers.txt" | ./hostsblock/hostsblock - > ./indonesianadblockrules/hosts
         curl -s "https://raw.githubusercontent.com/abpvn/abpvn/master/filter/src/abpvn_ad_domain.txt" | ./hostsblock/hostsblock - > ./abpvn/hosts
         curl -s "https://raw.githubusercontent.com/easylist/listefr/master/liste_fr.txt" | ./hostsblock/hostsblock - > ./listefr/hosts
         curl -s "https://raw.githubusercontent.com/easylist/ruadlist/master/advblock/adservers.txt" | ./hostsblock/hostsblock - > ./ruadlist/hosts
         sudo rm -rf hostsblock
        env:
          key: ${{ secrets.key }} # if run.py requires passwords..etc, set it as secrets
      - name: Commit files # transfer the new html files back into the repository
        run: |
         git config --local user.name "Update"
         git add .
         git commit -m "Updating the hosts file"
      - name: Push changes # push the output folder to your repo
        uses: ad-m/github-push-action@master
        with:
         github_token: ${{ secrets.GITHUB_TOKEN }}
         force: true
